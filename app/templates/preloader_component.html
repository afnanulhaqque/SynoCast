<!-- 3D Puffy Cloud Preloader Component -->
<link rel="stylesheet" href="/assets/styles/preloader.css">

<div id="page-preloader" class="preloader-overlay">
    <div class="preloader-content">
        <div class="preloader-cloud-container">
            <div class="cloud-puffs">
                <!-- 5 Puffs to form the 3D Cloud Structure -->
                <div class="puff"></div>
                <div class="puff"></div>
                <div class="puff"></div>
                <div class="puff"></div>
                <div class="puff"></div>

                <!-- Shadow for grounding -->
                <div class="cloud-shadow"></div>
            </div>
        </div>
        <div class="preloader-text">SynoCast</div>
    </div>
</div>

<script>
    // Ensure smooth removal of preloader on page load
    window.addEventListener('load', function () {
        const preloader = document.getElementById('page-preloader');
        if (preloader) {
            setTimeout(() => {
                preloader.classList.add('hidden');
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 600);
            }, 600);
        }
    });

    // Show preloader on internal links to improve perceived performance
    document.addEventListener('click', function (e) {
        const link = e.target.closest('a');
        if (link &&
            link.href &&
            link.href.startsWith(window.location.origin) &&
            !link.href.includes('#') &&
            link.target !== '_blank' &&
            !e.ctrlKey && !e.metaKey && !e.shiftKey) {

            const preloader = document.getElementById('page-preloader');
            if (preloader) {
                preloader.style.display = 'flex';
                setTimeout(() => {
                    preloader.classList.remove('hidden');
                }, 10);
            }
        }
    }, { passive: true });

    // Fallback: Force hide after 8 seconds
    setTimeout(() => {
        const preloader = document.getElementById('page-preloader');
        if (preloader && !preloader.classList.contains('hidden')) {
            preloader.classList.add('hidden');
            setTimeout(() => {
                if (preloader) preloader.style.display = 'none';
            }, 600);
        }
    }, 8000);
</script>