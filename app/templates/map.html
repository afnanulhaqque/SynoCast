{% extends "base.html" %}

{% block title %}Global Map Explorer{% endblock %}

{% block head %}
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<style>
    /* Full height map container */
    #map-container {
        width: 100%;
        height: 85vh;
        /* Occupy significant screen space but allow scroll */
        position: relative;
        z-index: 1;
    }

    .leaflet-control-layers {
        border-radius: 8px !important;
        border: none !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
        padding: 10px !important;
        font-family: 'Poppins', sans-serif !important;
    }

    .map-overlay-info {
        position: absolute;
        bottom: 30px;
        left: 30px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(5px);
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        max-width: 300px;
        display: none;
        /* Hidden by default */
    }

    /* Custom Popups */
    .leaflet-popup-content-wrapper {
        border-radius: 16px;
        padding: 0;
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .leaflet-popup-content {
        margin: 0;
        width: 240px !important;
        font-family: 'Poppins', sans-serif;
    }

    .leaflet-popup-tip {
        background: white;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .weather-popup-card {
        text-align: center;
        padding: 15px;
        border-radius: 12px;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        min-width: 180px;
    }

    .popup-header {
        background: linear-gradient(135deg, #3a5ba0 0%, #3a5ba0 100%);
        color: white;
        padding: 12px 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .popup-body {
        padding: 15px;
        background: white;
    }

    .pointer-events-none {
        pointer-events: none;
    }

    .pointer-events-auto {
        pointer-events: auto;
    }

    /* Ensure search is above map controls */
    .z-3 {
        z-index: 1050 !important;
    }

    .focus-ring-none:focus {
        box-shadow: none !important;
    }
</style>
{% endblock %}

{% block body %}
<div id="map-container">
    <!-- Map Search Overlay -->
    <div class="position-absolute top-0 start-0 p-3 z-3 w-100 pointer-events-none" style="max-width: 320px;">
        <div class="input-group shadow-sm rounded-pill bg-white pointer-events-auto">
            <span class="input-group-text border-0 bg-transparent ps-3"><i
                    class="fas fa-search text-primary"></i></span>
            <input type="text" id="map-search-input" class="form-control border-0 bg-transparent focus-ring-none"
                placeholder="Search location..." autocomplete="off">
            <button class="btn border-0 bg-transparent pe-3" id="map-search-btn"><i
                    class="fas fa-arrow-right text-muted"></i></button>
        </div>
        <ul id="map-search-results" class="dropdown-menu w-100 mt-2 shadow-sm border-0 rounded-4 pointer-events-auto"
            style="display: none;">
        </ul>
    </div>

    <div id="weather-map" style="height: 100%; width: 100%;"></div>

    <!-- Info Overlay for Clicks -->
    <div id="map-info-panel" class="map-overlay-info">
        <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="mb-0 fw-bold" id="map-city">Unknown</h5>
            <button type="button" class="btn-close btn-sm" id="close-map-info"></button>
        </div>
        <div class="d-flex align-items-center mb-3">
            <i id="map-icon" class="fas fa-cloud fa-2x text-muted"></i>
            <div class="ms-2">
                <div class="fs-4 fw-bold" id="map-temp">--Â°</div>
                <div class="small text-muted" id="map-condition">--</div>
            </div>
        </div>
        <div class="row g-2 text-center small">
            <div class="col-4">
                <div class="bg-light rounded p-2">
                    <i class="fas fa-wind text-muted mb-1"></i>
                    <div class="fw-bold" id="map-wind">--</div>
                </div>
            </div>
            <div class="col-4">
                <div class="bg-light rounded p-2">
                    <i class="fas fa-tint text-muted mb-1"></i>
                    <div class="fw-bold" id="map-humidity">--%</div>
                </div>
            </div>
            <div class="col-4">
                <div class="bg-light rounded p-2">
                    <i class="fas fa-compress-arrows-alt text-muted mb-1"></i>
                    <div class="fw-bold" id="map-pressure">--</div>
                </div>
            </div>
        </div>
        <div class="mt-3 text-center">
            <a href="#" id="view-details-btn" class="btn btn-sm btn-primary rounded-pill w-100">View Full Forecast</a>
        </div>
    </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="/assets/js/map.js"></script>
{% endblock %}